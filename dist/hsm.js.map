{"version":3,"sources":["hsm.js"],"names":[],"mappings":"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","file":"hsm.js","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('namespace-diff')) :\n  typeof define === 'function' && define.amd ? define(['namespace-diff'], factory) :\n  global.Hsm = factory(global.namespaceDiff)\n}(this, function (namespaceDiff) { 'use strict';\n\n  var Hsm = function(options = {}) {\n    this._states = {};\n\n    // Add states passed in as options\n    var states = options.states;\n    for (var stateName in states) {\n      this.setState(stateName, states[stateName]);\n    }\n  };\n\n  // Get a parent state name from a child state name\n  Hsm.getParentStateName = function(stateName) {\n    if (!stateName) { return undefined; }\n    return stateName.substring(0, stateName.lastIndexOf('.'));\n  };\n\n  // Create a new state\n  Hsm.prototype.setState = function(stateName, stateDef) {\n    if (stateName) {\n      this._validateStateName(stateName);\n    }\n    this._states[stateName] = stateDef;\n  };\n\n  // Get a state by its name\n  Hsm.prototype.getState = function(stateName) {\n    return this._states[stateName];\n  };\n\n  // Whether or not the given state exists\n  Hsm.prototype.hasState = function(stateName) {\n    return !!this._states[stateName];\n  };\n\n  // Get the current state name\n  Hsm.prototype.currentStateName = function() {\n    return this._currentStateName;\n  };\n\n  // Get the current state\n  Hsm.prototype.currentState = function() {\n    return this._states[this._currentStateName];\n  };\n\n  // Transition to a new state\n  Hsm.prototype.transitionTo = function(newState) {\n    if (this.currentState() === newState) { return; }\n    if (!this.hasState(newState)) { return; }\n    var canceled = false;\n    var cancel = function() { canceled = true; };\n\n    // Determine if we have an index state specified.\n    // If so, we will transition to that instead\n    var indexState = newState + '.index';\n    if (this.hasState(indexState)) {\n      newState = indexState;\n    }\n\n    var diff;\n      diff = namespaceDiff(this.currentStateName(), newState);\n\n    var hsm = this;\n    return Promise.resolve(this.transition(diff, cancel))\n      .then(function() {\n        if (canceled) { return false; }\n        hsm._currentStateName = newState;\n      });\n  };\n\n  // A hook to write your own transition that can be\n  // sync or async\n  Hsm.prototype.transition = function(diff, cancel) {};\n\n  Hsm.prototype._validateStateName = function(stateName) {\n    if (!this._isValidStateName(stateName)) {\n      throw new Error('A parent state must exist to register ' + stateName);\n    }\n  };\n\n  Hsm.prototype._isValidStateName = function(stateName) {\n    return this.hasState(Hsm.getParentStateName(stateName));\n  };\n\n  var hsm = Hsm;\n\n  return hsm;\n\n}));\n"],"sourceRoot":"/source/"}